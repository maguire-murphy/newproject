!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.BehaviorOpt=t():e.BehaviorOpt=t()}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>s});var n=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},r=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},o=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},i=new(function(){function e(){this.trackingId="",this.apiUrl="http://localhost:4000",this.userId="",this.sessionId="",this.assignments={},this.eventQueue=[],this.config={}}return e.prototype.init=function(e,t){void 0===t&&(t={}),this.trackingId=e,this.config=t,this.apiUrl=t.apiUrl||this.apiUrl,this.sessionId=this.generateSessionId(),this.userId=this.getOrCreateUserId(),this.loadAssignments(),this.setupBatching(),t.debug&&console.log("BehaviorOpt initialized",{trackingId:e,userId:this.userId})},e.prototype.identify=function(e,t){this.userId=e,localStorage.setItem("behavioropt_user_id",e),this.track("$identify",t)},e.prototype.track=function(e,t){var n={userId:this.userId,eventType:e,properties:t||{},context:this.getContext(),sessionId:this.sessionId,timestamp:(new Date).toISOString()};this.eventQueue.push(n),this.eventQueue.length>=10&&this.flush()},e.prototype.getVariant=function(e){return this.assignments[e]||null},e.prototype.applyInterventions=function(){var e=this;Object.entries(this.assignments).forEach(function(t){var n=t[0],r=t[1];e.applyIntervention(n,r)})},e.prototype.applyIntervention=function(e,t){this.config.debug&&console.log("Applying intervention",{experimentId:e,variantId:t})},e.prototype.loadAssignments=function(){return n(this,void 0,void 0,function(){var e,t,n;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,fetch("".concat(this.apiUrl,"/api/tracking/").concat(this.trackingId,"/assignments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId})})];case 1:return(e=r.sent()).ok?[4,e.json()]:[3,3];case 2:t=r.sent(),this.assignments=t.assignments||{},this.applyInterventions(),r.label=3;case 3:return[3,5];case 4:return n=r.sent(),this.config.debug&&console.error("Failed to load assignments",n),[3,5];case 5:return[2]}})})},e.prototype.flush=function(){return n(this,void 0,void 0,function(){var e,t;return r(this,function(n){switch(n.label){case 0:if(0===this.eventQueue.length)return[2];e=o([],this.eventQueue,!0),this.eventQueue=[],n.label=1;case 1:return n.trys.push([1,3,,4]),[4,fetch("".concat(this.apiUrl,"/api/tracking/").concat(this.trackingId,"/batch"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e})})];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this.eventQueue=e.concat(this.eventQueue),this.config.debug&&console.error("Failed to send events",t),[3,4];case 4:return[2]}})})},e.prototype.setupBatching=function(){var e=this;setInterval(function(){return e.flush()},5e3),window.addEventListener("beforeunload",function(){return e.flush()})},e.prototype.getOrCreateUserId=function(){var e=localStorage.getItem("behavioropt_user_id");return e||(e="anon_".concat(this.generateId()),localStorage.setItem("behavioropt_user_id",e)),e},e.prototype.generateSessionId=function(){return"sess_".concat(this.generateId())},e.prototype.generateId=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)},e.prototype.getContext=function(){return{url:window.location.href,referrer:document.referrer,userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,deviceType:this.getDeviceType()}},e.prototype.getDeviceType=function(){var e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"},e}());"undefined"!=typeof window&&(window.BehaviorOpt=i);const s=i;return t})());